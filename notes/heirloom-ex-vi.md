# Boiling heirloom-ex-vi

## Overview

heirloom-ex-vi is the classic Unix `ex`/`vi` text editor. The build system uses a custom `./configure` script and Make.

## Handlers Added

### Shell/Script Errors

1. **`handle_shell_command_not_found`** - Updated to handle two patterns:
   - dash style: `./test.sh: 2: ./configure: not found`
   - bash style: `./test.sh: line 3: ./configure: No such file or directory`

2. **`handle_cat_no_such_file`** - `cat: Makefile.in: No such file or directory`

3. **`handle_diff_no_such_file`** - `diff: test.txt: No such file or directory`

4. **`handle_sh_cannot_open`** - `sh: 0: cannot open makeoptions: No such file`

5. **`handle_sh_cant_cd`** - `cd: can't cd to libuxre` (directory doesn't exist)

### Make Errors

6. **`handle_make_no_makefile_found`** - Handles both:
   - `make[1]: *** No targets specified and no makefile found.  Stop.`
   - `make[1]: Makefile: No such file or directory`
   
   Detects subdirectory from "Entering directory" and restores all files in that subdir.

7. **`handle_make_missing_target`** - Updated to:
   - Handle subdirectory context (prepend subdir path to missing files)
   - Convert `.o` targets to `.c` source files
   - Match both `make:` and `make[N]:` patterns

8. **`handle_make_recipe_failed`** - When a make recipe fails (`make: *** [Makefile:291: ex_vars.h] Error 1`), check if the target is a deleted file and restore it directly from git instead of trying to run the failing recipe.

### C/C++ Build Errors

9. **`handle_c_linker_missing_object`** - `/usr/bin/ld: cannot find exrecover.o: No such file or directory`
   - Restores corresponding `.c` source file

10. **`handle_ar_missing_object`** - `ar: onefile.o: No such file or directory`
    - Handles subdirectory context
    - Restores corresponding `.c` source file

## Key Lessons

### 1. Generated Files in Git
Some files like `ex_vars.h` are both generated by build scripts AND tracked in git. When the generation fails (e.g., makeoptions uses `ex` commands that don't work), we can restore the file directly from git instead of trying to fix the build script.

### 2. Subdirectory Context
Many errors from `make[N]` don't include the full path to missing files. The "Entering directory" message provides context. Handlers need to:
- Parse `make[N]: Entering directory '/path/to/subdir'`
- Prepend the subdirectory to relative file paths

### 3. Object Files â†’ Source Files
When make/linker/ar can't find `.o` files, we need to restore the corresponding source (`.c`, `.cc`, etc.) since object files aren't tracked in git.

### 4. Shell Dialect Differences
Error message formats differ between shells:
- dash: `./script.sh: 2: ./cmd: not found`
- bash: `./script.sh: line 2: ./cmd: No such file or directory`

### 5. Robustness of --clear
Fixed `boil --clear` to not crash when the boiling branch doesn't exist. Used `subprocess.run()` with `capture_output=True` instead of `check_call()`.

## Test Command

```bash
cd /root/heirloom-ex-vi
git ls-files | grep -v test.sh | xargs rm -f
/root/boiler/boil -n 100 ./test.sh
```

The repo typically needs ~40 iterations to fully restore and build.
